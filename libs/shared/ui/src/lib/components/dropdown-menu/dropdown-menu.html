<div class="dropdown-container">
  <button
    type="button"
    class="dropdown-trigger"
    [class.dropdown-trigger--open]="isOpen()"
    (click)="toggle()"
    (keydown)="handleTriggerKeydown($event)"
    [attr.aria-expanded]="isOpen()"
    [attr.aria-label]="ariaLabel() || 'Dropdown menu'"
  >
    @if (selectedOption(); as option) { @if (option.icon) {
    <mat-icon class="trigger-icon" aria-hidden="true"
      >{{ option.icon }}</mat-icon
    >
    }
    <span class="trigger-text">{{ option.label }}</span>
    } @else {
    <span class="trigger-text placeholder">{{ searchPlaceholder() }}</span>
    }

    <span
      class="dropdown-arrow"
      [class.dropdown-arrow--rotated]="isOpen()"
      aria-hidden="true"
    >
      <mat-icon [style.color]="isOpen() ? '#175CD3' : '#344054'">
        keyboard_arrow_down
      </mat-icon>
    </span>
  </button>

  @if (isOpen()) {
  <div
    class="dropdown-menu"
    role="menu"
    [attr.aria-label]="ariaLabel() || 'Options menu'"
  >
    <div class="search-container" role="presentation">
      <mat-icon class="search-box-icon" [style.color]="'#193154'">
        search
      </mat-icon>
      <input
        type="text"
        class="search-input"
        [placeholder]="searchPlaceholder()"
        [value]="searchQuery()"
        (input)="updateSearchQuery($any($event.target).value)"
        [attr.aria-label]="searchPlaceholder() || 'Search options'"
        autocomplete="off"
      />
      <mat-icon class="search-box-icon-end" aria-hidden="true"
        >crop_free</mat-icon
      >
    </div>

    <div class="options-container" role="presentation">
      @for (option of filteredOptions(); track option.value) {
      <button
        type="button"
        class="dropdown-option"
        [class.dropdown-option--selected]="isSelected(option)"
        (click)="selectOption(option)"
        role="menuitem"
        [attr.aria-label]="option.label + (isSelected(option) ? ' (currently selected)' : '')"
      >
        @if (option.icon) {
        <mat-icon class="option-icon" aria-hidden="true"
          >{{ option.icon }}</mat-icon
        >
        }
        <span class="option-label">{{ option.label }}</span>
      </button>
      } @empty {
      <div class="no-results" role="status" aria-live="polite">
        No results found
      </div>
      }
    </div>
  </div>
  }
</div>
